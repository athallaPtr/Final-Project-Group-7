#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ====================== ENUM, UNION, STRUCT ======================
//Raisha : Transportation Options
typedef enum { 
    BUS = 1,
    TRAIN, 
    BICYCLE, 
    WALKING 
} TransportType;

typedef union {
    float cost;      
    int calories;    
} CostOrCalories;

//Alia : Trip recorder data structure
typedef struct {
    char destination[50];
    float distance;
    float emissionSaved;
    TransportType type;
    CostOrCalories info;
} Trip;

// ================= GLOBAL VARIABLES =================
// Alia: Dynamic storage handling
Trip *trips = NULL; 
int count = 0; 
int capacity = 5;

// ======== FUNCTION PROTOTYPES ========
void addTrip(); //(Paksi)
void showTrips(); //(atha)
void showSummary(); //(atha)
float calculateEmission(TransportType type, float distance); // Paksi
char* getTransportName(TransportType type);  //(Raisha)
void expandMemoryIfNeeded(); //(alia)

// ====================== MAIN MENU ======================
// Athalla: Input System + Menu Handling
int main(){
    int choice;
    trips = malloc(capacity * sizeof(struct Trip));

    while (1) {
        printf("\n====== SDG 11: Sustainable Mobility System ======\n");
        printf("1. Add Trip\n");
        printf("2. View Trips\n");
        printf("3. Show Summary\n");
        printf("4. Export Report\n");
        printf("5. Exit\n");
        printf("Choose: ");
        scanf("%d", &choice);

        switch(choice) {
            case 1: addTrip(); break;
            case 2: showTrips(); break;
            case 3: showSummary(); break;
            case 4: 
                printf("\nExiting program...\n");
                free(trips);
                return 0;
            default:
                printf("Invalid input.\n");
        }
    }

    return 0;
}

// ====================== FUNCTIONS ======================
// ------------------- ADD TRIP ---------------------------
// Paksi (input + transport logic)
void addTrip() {
    expandMemoryIfNeeded();

    printf("\n--- Add Trip ---\n");

    printf("Destination: ");
    scanf(" %[^\n]", trips[count].destination);

    do {
        printf("Distance (km): ");
        scanf("%f", &trips[count].distance);
        if (trips[count].distance <= 0)
            printf("Must be greater than 0.\n");
    } while (trips[count].distance <= 0);

    int category;
    printf("\nSelect category:\n");
    printf("1. Public Transport\n");
    printf("2. Private (Bicycle)\n");
    printf("3. Walking\n");
    printf("Choose: ");
    scanf("%d", &category);

    if(category == 1){
        printf("\nPublic Transport:\n1. Bus\n2. Train\nChoose: ");
        scanf("%d", &trips[count].type);

        if(trips[count].type != BUS && trips[count].type != TRAIN){
            printf("Invalid input.\n");
            return;
        }

        printf("Ticket Cost: ");
        scanf("%f", &trips[count].info.cost);

    } else if (category == 2){
        trips[count].type = BICYCLE;
        printf("Calories burned: ");
        scanf("%d", &trips[count].info.calories);

    } else if (category == 3){
        trips[count].type = WALKING;
        printf("Calories burned: ");
        scanf("%d", &trips[count].info.calories);

    } else {
        printf("Invalid category.\n");
        return;
    }

    // Paksi: COâ‚‚ Formula
    trips[count].emissionSaved = calculateEmission(trips[count].type, trips[count].distance);
    count++;

    printf("\nTrip Added Successfully!\n");
}

// ------------------- SHOW TRIPS ------------------------
// Athalla
void showTrips() {
    if(count == 0) {
        printf("\nNo trips recorded.\n");
        return;
    }

    printf("\n--- Trip History ---\n");
    for(int i=0; i<count; i++){
        printf("%d. %s | %.2f km | %s | CO2 Saved: %.2f g | ",
            i+1,
            trips[i].destination,
            trips[i].distance,
            getTransportName(trips[i].type),
            trips[i].emissionSaved);

        if(trips[i].type == BUS || trips[i].type == TRAIN)
            printf("Cost: %.2f\n", trips[i].info.cost);
        else
            printf("Calories: %d\n", trips[i].info.calories);
    }
}

// ------------------- SUMMARY REPORT --------------------
// Athalla
void showSummary() {
    if(count == 0){
        printf("\nNo summary available.\n");
        return;
    }

    float totalDistance = 0, totalEmission = 0;
    int public=0, private=0, walking=0;

    for(int i=0; i<count; i++){
        totalDistance += trips[i].distance;
        totalEmission += trips[i].emissionSaved;

        if(trips[i].type == BUS || trips[i].type == TRAIN) public++;
        else if(trips[i].type == BICYCLE) private++;
        else walking++;
    }

    printf("\n--- Summary ---\n");
    printf("Total Trips: %d\n", count);
    printf("Total Distance: %.2f km\n", totalDistance);
    printf("Total CO2 Saved: %.2f g\n\n", totalEmission);

    printf("Category Breakdown:\n");
    printf(" - Public Transport: %d\n", public);
    printf(" - Bicycle: %d\n", private);
    printf(" - Walking: %d\n", walking);
}

// ------------------- HELPERS ---------------------------
// Paksi
float calculateEmission(TransportType type, float distance){
    if(type == BUS) return distance * 80;
    if(type == TRAIN) return distance * 100;
    return distance * 200;
}

// Raisha
char* getTransportName(TransportType type){
    if(type == BUS) return "Bus";
    if(type == TRAIN) return "Train";
    if(type == BICYCLE) return "Bicycle";
    return "Walking";
}

// Alia
void expandMemoryIfNeeded(){
    if(count>= capacity) {
        capacity *= 2;
        trips = realloc(trips, capacity * sizeof(Trip));
    } 
}

